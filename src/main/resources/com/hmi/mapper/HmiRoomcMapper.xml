<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hmi.mapper.HmiRoomcMapper">

	<select id="selectRoomList" resultType="hashmap">
		SELECT
			No,
			Floor,
			Ho,
			InsideTemp,
			SetTemp,
			InHeating,
			OutHeating,
			NowControlValue,
			SetControlValue,
			DATE_FORMAT(RegDate, '%Y-%m-%d %H:%i:%s') AS RegDate,
			NowFlow,
			TotalFlow,
			(CASE WHEN OnOff = 0 THEN 'OFF' WHEN OnOff = 1 THEN 'ON' END) AS OnOff,
			TotalHeat,
			DATE_FORMAT(SetDate, '%Y-%m-%d %H:%i:%s') AS SetDate,
			InHeating - OutHeating AS DiffHeating
		FROM
			RoomB
		<where>
			<if test="ho != null and ho != ''">
			AND Ho = #{ho}
			</if>
			<if test="regDate != null and regDate != ''">
			AND date_format(RegDate,'%Y%m%d') = #{regDate}
			</if>
		</where>
		ORDER BY
			RegDate DESC
    </select>
    
	<select id="selectRoomTempSts" resultType="hashmap">
	    SELECT
			date_format(RegDate,'%H') as HH,
			round(avg(InsideTemp), 1) as InsideTemp,
			round(avg(SetTemp), 1) as SetTemp
		FROM
			RoomB
		WHERE
			date_format(RegDate,'%Y%m%d') = #{regDate}
			<if test="ho != null">
			AND Ho = #{ho}
			</if>
		GROUP BY
			date_format(RegDate,'%Y%m%d%H')
    </select>

</mapper>